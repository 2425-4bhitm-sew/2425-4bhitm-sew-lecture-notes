(function(){angular.module("hybris-api",["hybris-auth-service","hybris-cart-service","hybris-user-data-service","hybris-user-service"])})();(function(){angular.module("hybris-auth-service",["ngCookies"]).service("HybrisAuthService",["$cookies",function(d){var f={getAuthorizationToken:function(){return d.getObject("HybrisAuthToken")},getAuthorizationHeader:function(){var d=f.getAuthorizationToken();if(d&&d.token_type&&d.access_token)return d.token_type+" "+d.access_token}};return f}])})();
(function(){angular.module("hybris-cart-service",["hybris-auth-service"]).service("HybrisCartService",["$log","$q","$http","HybrisAuthService",function(d,f,h,k){return{getCartForUser:function(c){var e=f.defer(),g=k.getAuthorizationHeader();c?g?h({method:"GET",url:"/fmwebservice/v2/federalmogul/users/"+c+"/carts",headers:{Authorization:g}}).then(function(c){d.debug("Cart response",c.data);e.resolve(c.data)},function(c){d.error(c);e.reject(c)}):e.reject("User is not authorized"):e.reject("User must be specified");
return e.promise}}}])})();
(function(){Array.isArray||(Array.isArray=function(d){return"[object Array]"===Object.prototype.toString.call(d)});angular.module("hybris-user-service",["hybris-auth-service"]).service("HybrisUserService",["$log","$q","$http","HybrisAuthService",function(d,f,h,k){var c={},e,g,m,l,n=function(b){if(b&&b.roles&&b.isGarageRewardMember)for(var a=0;a<b.roles.length;a++)b.roles[a]&&"FMB2T"===b.roles[a].toUpperCase()&&(b.roles[a]="FMB2T-GW")};c.getUserInfo=function(){var b=f.defer(),a=k.getAuthorizationHeader();
a?e?(d.debug("Cached userinfo"),b.resolve(e)):g&&0<g.length?g.push(b):(g=[b],h({method:"GET",url:"/fmwebservice/v1/federalmogul/customers/current?t\x3d"+(new Date).getTime(),headers:{Authorization:a}}).then(function(a){n(a.data);d.debug("User data response",a.data);e=a.data;angular.forEach(g,function(b){b.resolve(a.data)});g=null},function(a){d.error(a);angular.forEach(g,function(b){b.reject(a)});g=null})):b.reject("User is not authorized");return b.promise};c.getRoles=function(){var b=f.defer();
c.getUserInfo().then(function(a){b.resolve(a.roles)},function(a){b.reject(a)});return b.promise};c.userSessionTransport=function(){var b=f.defer(),a=k.getAuthorizationHeader();a?m?(d.debug("Cached user session info"),b.resolve(m)):l&&0<l.length?l.push(b):(l=[b],h({method:"GET",url:"/fmwebservice/v1/federalmogul/customers/currentUserSessionState?t\x3d"+(new Date).getTime(),headers:{Authorization:a}}).then(function(a){m=a.data;d.debug("User session data response:",m);angular.forEach(l,function(b){b.resolve(a.data)});
l=null},function(a){d.debug("User session data request resulted in error:",a);angular.forEach(l,function(b){b.reject(a)});l=null})):b.reject("User is not authorized");return b.promise};c.getUserSessionInfo=function(){var b=f.defer();f.all([c.getUserInfo(),c.userSessionTransport()]).then(function(a){b.resolve(a)},function(a){b.reject(a)});return b.promise};c.getNabsAccountCode=function(){var b=f.defer();c.getUserSessionInfo().then(function(a){if("undefined"!==typeof a&&$.isArray(a)&&2<=a.length){var c=
a[0];a=a[1];a.isCSREmulated?b.resolve(a.nabsId):"undefined"!==typeof c&&"undefined"!==typeof c.unit?b.resolve(c.unit.nabsAccountCode):b.resolve(void 0)}else b.resolve(void 0)},function(a){b.resolve(void 0)});return b.promise};c.isCSREmulated=function(){var b=f.defer();c.getUserSessionInfo().then(function(a){"undefined"!==typeof a&&$.isArray(a)&&2<=a.length?b.resolve(a[1].isCSREmulated):b.resolve(void 0)},function(a){b.resolve(void 0)});return b.promise};c.getSAPAccountCode=function(){var b=f.defer();
c.getUserSessionInfo().then(function(a){if("undefined"!==typeof a&&$.isArray(a)&&2<=a.length){var c=a[0];a=a[1];a.isCSREmulated?b.resolve(a.accountId):"undefined"!==typeof c&&"undefined"!==typeof c.unit?b.resolve(c.unit.uid):b.resolve(void 0)}else b.resolve(void 0)},function(a){b.resolve(void 0)});return b.promise};c.getAccountName=function(){var b=f.defer();c.getUserSessionInfo().then(function(a){"undefined"!==typeof a&&$.isArray(a)&&2<=a.length?(a=a[1],a.isCSREmulated?b.resolve(a.accountName):b.resolve(void 0)):
b.resolve(void 0)},function(a){b.resolve(void 0)});return b.promise};c.hasRole=function(b,a){var c=!1;if(Array.isArray(b))b=b.join(",").toLowerCase();else if("string"===typeof b||b instanceof String)b=b.toLowerCase();b=b.split(",");if(Array.isArray(a))a=a.join(",").toLowerCase();else if("string"===typeof a||a instanceof String)a=a.toLowerCase();if(""!==a){a=a.toLowerCase().split(",");for(var d in a)-1<b.indexOf(a[d])&&(c=!0)}else c=!0;return c};c.hasRoleAsync=function(b){var a=f.defer();c.getRoles().then(function(e){c.hasRole(e,
b)?(d.debug(e+" contained one of these roles '"+b+"'"),a.resolve()):(d.debug(e+" did not contain any of "+b),a.reject())},function(b){d.error("Could not retrieve roles");a.reject(b)});return a.promise};c.updateUserProfile=function(b){var a=f.defer(),c=k.getAuthorizationHeader();c?h({method:"POST",url:"/fmwebservice/v1/federalmogul/customers/current/profile?t\x3d"+(new Date).getTime(),headers:{Authorization:c},params:b}).then(function(b){d.debug("User data response",b.data);n(b.data);e=b.data;a.resolve(e)},
function(b){d.error(b);a.reject(b)}):a.reject("User is not authorized");return a.promise};c.getUserDetails=function(b){var a=f.defer(),c=k.getAuthorizationHeader();c?h({method:"GET",url:"/fmwebservice/v1/federalmogul/customers/customerById/"+b,headers:{Authorization:c}}).then(function(b){d.debug("User details data response:",b.data);a.resolve(b.data)},function(b){d.error("Error in HybrisUserService.getUserDetails:",b);a.reject(b)}):a.reject("User is not authorized");return a.promise};return c}])})();
(function(){angular.module("hybris-user-data-service",["hybris-auth-service"]).service("HybrisUserDataService",["$log","$q","$http","HybrisUserService",function(d,f,h,k){h={};var c={};h.getUserData=function(e){var g=f.defer();c[e]?(d.debug("Cached userdata",c[e]),g.resolve(c[e])):k.getUserInfo().then(function(f){f&&f.fmBrandCampaignList&&angular.forEach(f.fmBrandCampaignList,function(d){d.fmBrandCampaignID&&d.fmBrandCampaignInfo&&(c[d.fmBrandCampaignID]=JSON.parse(d.fmBrandCampaignInfo))});c[e]?(d.debug("Non-cached userdata",
c[e]),g.resolve(c[e])):g.reject("User did not have user data for this campaign")},function(c){g.reject(c)});return g.promise};h.saveUserData=function(c,g){var e=f.defer();c={BrandCampaignId:c,BrandCampaignInfo:JSON.parse(angular.toJson(g))};k.updateUserProfile(c).then(function(c){d.debug("Updated profile data: ",c);e.resolve(c)},function(c){d.error("Could not update profile data: ",c);e.reject(c)});return e.promise};return h}])})();